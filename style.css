<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Biblioteca de Posições</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- ===== Splash ===== -->
  <div id="splash">
    <h1>Jiu-Jitsu Puro</h1>
  </div>

  <!-- ===== Tela Inicial ===== -->
  <div id="home" class="screen" style="display:none;">
    <h1><i class="fa-solid fa-sitemap"></i> Biblioteca de Posições</h1>
    <div class="carousel">
      <div class="carousel-track" id="carousel-track"></div>
    </div>
    <a href="index.html" class="main-menu-btn">Voltar ao Menu Principal</a>
  </div>

  <!-- ===== Tela Detalhe ===== -->
  <div id="detalhe" class="screen" style="display:none;">
    <h1 id="detalhe-titulo"></h1>
    <div id="detalhe-grid"></div>
    <button class="back-btn" onclick="voltarHome()">Voltar</button>
  </div>

  <!-- ===== Botão flutuante ===== -->
  <button id="add-btn"><i class="fa-solid fa-plus"></i></button>

  <!-- ===== Modal ===== -->
  <div id="modal">
    <div class="modal-content">
      <h2>Adicionar Nova Posição</h2>
      <input type="text" id="novaNome" placeholder="Nome da posição" required>
      <select id="novaTipo">
        <option value="Guarda">Guarda</option>
        <option value="Passagem">Passagem</option>
        <option value="Controle">Controle</option>
        <option value="Finalização">Finalização</option>
        <option value="Queda">Queda</option>
      </select>
      <textarea id="novaDesc" rows="3" placeholder="Descrição da posição"></textarea>
      <div>
        <button class="btn-save" onclick="salvarPosicao()">Salvar</button>
        <button class="btn-cancel" onclick="fecharModal()">Cancelar</button>
      </div>
    </div>
  </div>

  <script>
    // ===== Sons =====
    function playSound(file) {
      const audio = new Audio(file);
      audio.volume = 0.5;
      audio.play();
    }

    // ===== Dados iniciais (resumidos p/ exemplo, ajuste conforme quiser 20 em cada) =====
    const categorias = JSON.parse(localStorage.getItem("posicoesData")) || {
      Guarda: { icon: '<i class="fa-solid fa-shield-halved"></i>', posicoes: [
        { nome: 'Guarda Fechada', desc: 'Controle com pernas cruzadas.' },
        { nome: 'Guarda Aberta', desc: 'Controle de distância.' }
      ]},
      Passagem: { icon: '<i class="fa-solid fa-right-left"></i>', posicoes: [
        { nome: 'Torreando', desc: 'Contorna as pernas.' },
        { nome: 'Knee Cut', desc: 'Joelho cortando a guarda.' }
      ]},
      Controle: { icon: '<i class="fa-solid fa-user-shield"></i>', posicoes: [
        { nome: 'Montada', desc: 'Sentado no torso.' },
        { nome: '100kg', desc: 'Controle lateral básico.' }
      ]},
      Finalização: { icon: '<i class="fa-solid fa-lock"></i>', posicoes: [
        { nome: 'Armlock', desc: 'Chave de braço.' },
        { nome: 'Mata-Leão', desc: 'Estrangulamento costas.' }
      ]},
      Queda: { icon: '<i class="fa-solid fa-arrow-down"></i>', posicoes: [
        { nome: 'Double Leg', desc: 'Ataque às duas pernas.' },
        { nome: 'Single Leg', desc: 'Ataque a uma perna.' }
      ]}
    };

    const splash = document.getElementById("splash");
    const home = document.getElementById("home");
    const detalhe = document.getElementById("detalhe");
    const detalheGrid = document.getElementById("detalhe-grid");
    const detalheTitulo = document.getElementById("detalhe-titulo");
    const track = document.getElementById("carousel-track");
    const modal = document.getElementById("modal");

    // ===== Splash =====
    window.addEventListener('load', () => {
      setTimeout(() => {
        playSound('sounds/impact.mp3');
        splash.classList.add("hiding");
        splash.addEventListener("animationend", () => {
          splash.style.display = "none";
          home.style.display = "block";
        }, { once: true });
      }, 1200);
    });

    // ===== Renderizar tela inicial =====
    function renderHome() {
      track.innerHTML = "";
      Object.keys(categorias).forEach(cat => {
        const card = document.createElement("div");
        card.className = "categoria-card";
        card.onclick = () => abrirDetalhe(cat);
        card.innerHTML = `<div class="icon">${categorias[cat].icon}</div><h3>${cat}</h3>`;
        track.appendChild(card);
      });
    }
    renderHome();

    // ===== Carrossel automático =====
    let index = 0;
    setInterval(() => {
      index = (index + 1) % Object.keys(categorias).length;
      track.style.transform = `translateX(-${index * 100}%)`;
    }, 3000);

    // ===== Abrir detalhe =====
    function abrirDetalhe(cat) {
      home.style.display = "none";
      detalhe.style.display = "block";
      detalheTitulo.innerText = cat;
      detalheGrid.innerHTML = "";
      categorias[cat].posicoes.forEach(p => {
        const card = document.createElement("div");
        card.className = "posicao-card";
        card.innerHTML = `<h4>${p.nome}</h4><p>${p.desc}</p>`;
        detalheGrid.appendChild(card);
      });
    }

    // ===== Voltar =====
    function voltarHome() {
      detalhe.style.display = "none";
      home.style.display = "block";
    }

    // ===== Modal =====
    document.getElementById("add-btn").onclick = () => {
      modal.style.display = "flex";
      playSound('sounds/click.mp3');
    };
    function fecharModal() { modal.style.display = "none"; }

    // ===== Salvar nova posição =====
    function salvarPosicao() {
      const nome = document.getElementById("novaNome").value.trim();
      const tipo = document.getElementById("novaTipo").value;
      const desc = document.getElementById("novaDesc").value.trim();

      if (!nome || !desc) { 
        alert("Preencha todos os campos!"); 
        return; 
      }

      categorias[tipo].posicoes.push({ nome, desc });
      localStorage.setItem("posicoesData", JSON.stringify(categorias));
      fecharModal();
      renderHome();
      playSound('sounds/success.mp3');
      alert("Nova posição adicionada!");
    }
  </script>
</body>
</html>