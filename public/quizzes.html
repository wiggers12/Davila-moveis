<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jiu-Jitsu Puro - Quizzes</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div id="quizzes" class="screen center-content" style="display: flex;">
    <div>
        <h1>Menu de Quizzes</h1>
        <div id="placar">Placar: 0 acertos</div>
        <div class="cards">
            <div class="card" onclick="abrirConteudo('O come√ßo','comeco')"><a><i class="fa-solid fa-flag-checkered"></i>O come√ßo</a></div>
            <div class="card" onclick="abrirConteudo('Regras do Jiu Jitsu','regras')"><a><i class="fa-solid fa-scroll"></i>Regras</a></div>
            <div class="card" onclick="abrirConteudo('Regras do Tatame','tatame')"><a><i class="fa-solid fa-user-shield"></i>Regras do Tatame</a></div>
            <div class="card" onclick="abrirConteudo('Mentalidade','mentalidade')"><a><i class="fa-solid fa-brain"></i>Mentalidade</a></div>
            <div class="card" onclick="abrirConteudo('Guarda','guarda')"><a><i class="fa-solid fa-shield-halved"></i>Guarda</a></div>
            <div class="card" onclick="abrirConteudo('Passagens','passagens')"><a><i class="fa-solid fa-right-left"></i>Passagens</a></div>
            <div class="card" onclick="abrirConteudo('Meia Guarda','meiaguarda')"><a><i class="fa-solid fa-circle-notch"></i>Meia Guarda</a></div>
            <div class="card" onclick="abrirConteudo('Finaliza√ß√µes','finalizacoes')"><a><i class="fa-solid fa-lock"></i>Finaliza√ß√µes</a></div>
            <div class="card" onclick="abrirConteudo('Quedas','quedas')"><a><i class="fa-solid fa-arrow-down"></i>Quedas</a></div>
            <div class="card" onclick="abrirConteudo('Drills','drills')"><a><i class="fa-solid fa-sync-alt"></i>Drills</a></div>
        </div>
        <a href="index.html" class="main-menu-btn">Voltar ao Menu Principal</a>
    </div>
  </div>

  <div id="conteudo" class="screen center-content" style="display: none;">
    <div class="content-box">
      <h2 id="conteudo-titulo"></h2>
      <p id="conteudo-texto"></p>
      <div id="quiz-area" class="quiz-container"></div>
      <button class="back-btn" onclick="showScreen('quizzes')">Voltar ao Menu de Quizzes</button>
    </div>
  </div>

  <script type="module">
    import { verificarAcesso } from "./firebase.js";

    const conteudos = {
      comeco: `<strong>O Come√ßo:</strong> Iniciar no Jiu-Jitsu pode parecer desafiador, mas cada treino √© evolu√ß√£o. Teste seus conhecimentos b√°sicos.`,
      regras: `<strong>Regras:</strong> Entender a pontua√ß√£o e as regras b√°sicas √© fundamental.`,
      tatame: `<strong>Tatame:</strong> O tatame √© um local sagrado com regras de respeito.`,
      mentalidade: `<strong>Mentalidade:</strong> A mente √© t√£o importante quanto o corpo no Jiu-Jitsu.`,
      guarda: `<strong>Guarda:</strong> A guarda √© a ess√™ncia do Jiu-Jitsu.`,
      passagens: `<strong>Passagens:</strong> Passar a guarda √© um dos maiores desafios.`,
      meiaguarda: `<strong>Meia Guarda:</strong> Uma posi√ß√£o complexa e cheia de detalhes.`,
      finalizacoes: `<strong>Finaliza√ß√µes:</strong> O objetivo final da luta.`,
      quedas: `<strong>Quedas:</strong> Levar a luta para o ch√£o √© uma arte.`,
      drills: `<strong>Drills:</strong> A repeti√ß√£o leva √† perfei√ß√£o.`
    };

    let quizzes = {};        // conte√∫do do quizzes.json
    let pontos = 0;
    let currentQuizKey = null;
    let currentQuestionIndex = 0;
    let currentQuizScore = 0;
    let perguntasAtuais = [];

    // Carregar quizzes.json na inicializa√ß√£o
    async function carregarQuizzes() {
      try {
        const res = await fetch("quizzes.json");
        quizzes = await res.json();
        console.log("‚úÖ quizzes.json carregado:", quizzes);
      } catch (e) {
        console.error("Erro ao carregar quizzes.json:", e);
        alert("Erro ao carregar perguntas.");
      }
    }
    carregarQuizzes();

    async function abrirConteudo(titulo, chave) {
      document.getElementById("conteudo-titulo").innerText = titulo;
      document.getElementById("conteudo-texto").innerHTML = conteudos[chave] || "";
      currentQuizKey = chave;
      currentQuestionIndex = 0;
      currentQuizScore = 0;

      // üî• Buscar perguntas do quizzes.json
      perguntasAtuais = quizzes[chave]?.perguntas || [];

      if (perguntasAtuais.length === 0) {
        alert("‚ö†Ô∏è Nenhuma pergunta cadastrada ainda.");
        return;
      }

      displayQuestion();
      showScreen('conteudo');
    }

    function displayQuestion() {
      const quizArea = document.getElementById("quiz-area");
      const quizData = perguntasAtuais[currentQuestionIndex];
      if (!quizData) return;
      quizArea.innerHTML = "";

      const questionTitle = document.createElement("h3");
      questionTitle.className = "quiz-question";
      questionTitle.innerText = quizData.pergunta;

      const optionsContainer = document.createElement("div");
      optionsContainer.className = "quiz-options";

      quizData.opcoes.forEach((opcao, index) => {
        const optionDiv = document.createElement("div");
        optionDiv.className = "option";
        optionDiv.innerText = opcao;
        optionDiv.onclick = () => selectAnswer(index, quizData.correta, optionDiv);
        optionsContainer.appendChild(optionDiv);
      });

      const progressIndicator = document.createElement("div");
      progressIndicator.className = "quiz-progress";
      progressIndicator.innerText = `Pergunta ${currentQuestionIndex + 1} de ${perguntasAtuais.length}`;

      quizArea.appendChild(questionTitle);
      quizArea.appendChild(optionsContainer);
      quizArea.appendChild(progressIndicator);
      const feedbackDiv = document.createElement("div");
      feedbackDiv.className = "quiz-feedback";
      quizArea.appendChild(feedbackDiv);
    }

    function selectAnswer(selectedIndex, correctIndex, selectedElement) {
      const quizArea = document.getElementById("quiz-area");
      const options = quizArea.querySelectorAll(".option");
      const feedbackDiv = quizArea.querySelector(".quiz-feedback");
      options.forEach(opt => opt.classList.add("disabled"));

      if (selectedIndex === correctIndex) {
        selectedElement.classList.add("correct");
        feedbackDiv.innerText = "Correto! üëä";
        pontos++;
        currentQuizScore++;
        atualizarPlacar();
      } else {
        selectedElement.classList.add("wrong");
        options[correctIndex].classList.add("correct");
        feedbackDiv.innerText = "Incorreto! ‚ùå";
      }

      const nextButton = document.createElement("button");
      nextButton.className = "quiz-button";
      if (currentQuestionIndex < perguntasAtuais.length - 1) {
        nextButton.innerText = "Pr√≥xima Pergunta";
        nextButton.onclick = () => {
          currentQuestionIndex++;
          displayQuestion();
        };
      } else {
        nextButton.innerText = "Ver Resultado";
        nextButton.onclick = showFinalScore;
      }
      quizArea.appendChild(nextButton);
    }

    function showFinalScore() {
      const quizArea = document.getElementById("quiz-area");
      quizArea.innerHTML = `<div class="quiz-final-score"><h3>Fim do Quiz!</h3><p>Voc√™ acertou ${currentQuizScore} de ${perguntasAtuais.length} perguntas.</p></div>`;
    }

    function atualizarPlacar() {
      document.getElementById("placar").innerText = `Placar: ${pontos} acertos`;
    }

    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(el => el.style.display = 'none');
      const screenToShow = document.getElementById(id);
      screenToShow.style.display = 'flex';
      if (id === 'quizzes') atualizarPlacar();
    }

    // üîí Checa login/assinatura
    verificarAcesso((permitido, user) => {
      if (!permitido) {
        alert("‚ö†Ô∏è Voc√™ precisa assinar para acessar esta p√°gina.");
        window.location.href = "index.html";
      } else {
        console.log("‚úÖ Usu√°rio logado:", user.email);
      }
    });
  </script>
</body>
</html>
