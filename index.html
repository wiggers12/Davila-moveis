<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CatÃ¡logo de Produtos</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; margin:0; background:#f9f9f9; }
    header { background:#2c3e50; color:white; padding:15px; text-align:center; }
    .container { padding:20px; max-width:1200px; margin:auto; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(180px, 1fr)); gap:20px; }
    .card { background:white; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.1); cursor:pointer; transition:.3s; }
    .card:hover { transform:translateY(-3px); }
    .card img { width:100%; height:160px; object-fit:cover; border-radius:8px 8px 0 0; }
    .card .info { padding:10px; text-align:center; }
    .card h3 { margin:5px 0; font-size:16px; }
    .card p { margin:0; color:#3498db; font-weight:600; }

    /* Carrinho */
    #cart-btn { position:fixed; bottom:20px; right:20px; background:#3498db; color:white; border:none; border-radius:50%; width:60px; height:60px; font-size:24px; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,.2);}
    #cart-count { position:absolute; top:10px; right:10px; background:red; color:white; border-radius:50%; padding:4px 8px; font-size:12px; }

    /* Modal produto */
    .modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; z-index:1000; visibility:hidden; opacity:0; transition:.3s; }
    .modal.active { visibility:visible; opacity:1; }
    .modal-content { background:white; border-radius:10px; max-width:600px; width:95%; padding:20px; position:relative; }
    .close-btn { position:absolute; top:10px; right:10px; cursor:pointer; font-size:18px; color:#444; }

    .carousel { display:flex; overflow-x:auto; gap:10px; }
    .carousel img { height:200px; border-radius:8px; }

    .options { margin:15px 0; }
    .options label { font-weight:600; }
    .options select { padding:6px; margin-left:10px; }

    .btn { padding:10px 15px; border:none; border-radius:6px; cursor:pointer; font-weight:600; }
    .btn-primary { background:#3498db; color:white; }
    .btn-whatsapp { background:#25d366; color:white; margin-left:10px; }

    /* Carrinho */
    #cart-modal .cart-items { max-height:300px; overflow-y:auto; margin-bottom:15px; }
    #cart-modal table { width:100%; border-collapse:collapse; }
    #cart-modal th, #cart-modal td { border:1px solid #ddd; padding:8px; text-align:center; }
    #checkout { margin-top:15px; }
    #checkout button { width:100%; margin-top:10px; }
  </style>
</head>
<body>
  <header>
    <h1>CatÃ¡logo de Produtos</h1>
  </header>

  <main class="container">
    <div id="product-grid" class="grid">Carregando produtos...</div>
  </main>

  <!-- BotÃ£o carrinho -->
  <button id="cart-btn">ðŸ›’<span id="cart-count">0</span></button>

  <!-- Modal produto -->
  <div id="product-modal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('product-modal')">âœ–</span>
      <div id="product-detail"></div>
    </div>
  </div>

  <!-- Modal carrinho -->
  <div id="cart-modal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('cart-modal')">âœ–</span>
      <h2>ðŸ›’ Seu Carrinho</h2>
      <div class="cart-items" id="cart-items"></div>
      <div id="checkout">
        <button class="btn btn-primary" onclick="checkoutPix()">Pagar com Pix</button>
        <button class="btn btn-primary">Pagar com CartÃ£o</button>
        <button class="btn btn-primary">Pagar em Dinheiro</button>
        <button class="btn btn-whatsapp" onclick="checkoutWhatsApp()">Finalizar pelo WhatsApp</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB-rnG4cIZzEb1w_h_qmif3XPSx28ZIdaM",
      authDomain: "ecomercie-vendas.firebaseapp.com",
      projectId: "ecomercie-vendas",
      storageBucket: "ecomercie-vendas.firebasestorage.app",
      messagingSenderId: "1054540261609",
      appId: "1:1054540261609:web:90042b823220b4c73f6878",
      measurementId: "G-TNC5M9G89H"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let cart = JSON.parse(localStorage.getItem("cart")) || [];

    async function loadProducts() {
      const grid = document.getElementById("product-grid");
      try {
        const querySnapshot = await getDocs(collection(db, "products"));
        if (querySnapshot.empty) {
          grid.innerHTML = "<p>Nenhum produto encontrado.</p>";
          return;
        }
        let html = "";
        querySnapshot.forEach(doc => {
          const p = doc.data();
          html += `
            <div class="card" onclick="openProduct('${doc.id}')">
              <img src="${p.imagens?.[0] || 'https://via.placeholder.com/200'}" alt="${p.nome}">
              <div class="info">
                <h3>${p.nome}</h3>
                <p>R$ ${(p.valor||0).toFixed(2)}</p>
              </div>
            </div>`;
        });
        grid.innerHTML = html;
      } catch (err) {
        grid.innerHTML = "<p style='color:red'>Erro ao carregar produtos.</p>";
        console.error(err);
      }
    }

    window.openProduct = async function(productId) {
      const modal = document.getElementById("product-modal");
      const detail = document.getElementById("product-detail");
      const docSnap = await getDocs(collection(db, "products"));
      let product;
      docSnap.forEach(d => { if (d.id === productId) product = {id:d.id, ...d.data()} });
      if (!product) return;

      let imagesHtml = product.imagens?.map(img => `<img src="${img}" alt="">`).join("") || "";
      let coresHtml = product.cores ? `<label>Cor:</label><select id="sel-cor">${product.cores.map(c=>`<option>${c}</option>`)}</select>` : "";
      let tamanhosHtml = product.tamanhos ? `<label>Tamanho:</label><select id="sel-tam">${product.tamanhos.map(t=>`<option>${t}</option>`)}</select>` : "";

      detail.innerHTML = `
        <h2>${product.nome}</h2>
        <div class="carousel">${imagesHtml}</div>
        <p><strong>R$ ${(product.valor||0).toFixed(2)}</strong></p>
        <p>${product.descricao||''}</p>
        <div class="options">${coresHtml} ${tamanhosHtml}</div>
        <button class="btn btn-primary" onclick="addToCart('${product.id}')">Adicionar ao Carrinho</button>
        <button class="btn btn-whatsapp" onclick="buyWhatsApp('${product.nome}')">Comprar pelo WhatsApp</button>
      `;
      modal.classList.add("active");
    }

    window.closeModal = function(id) {
      document.getElementById(id).classList.remove("active");
    }

    window.addToCart = function(id) {
      if (!cart.find(c=>c.id===id)) {
        cart.push({id, qtd:1});
      } else {
        cart = cart.map(c=>c.id===id?{...c,qtd:c.qtd+1}:c);
      }
      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartCount();
      alert("Produto adicionado ao carrinho!");
    }

    function updateCartCount() {
      document.getElementById("cart-count").innerText = cart.reduce((a,b)=>a+b.qtd,0);
    }

    document.getElementById("cart-btn").addEventListener("click", () => {
      renderCart();
      document.getElementById("cart-modal").classList.add("active");
    });

    function renderCart() {
      const container = document.getElementById("cart-items");
      if (!cart.length) {
        container.innerHTML = "<p>Carrinho vazio</p>";
        return;
      }
      let html = "<table><tr><th>Produto</th><th>Qtd</th></tr>";
      cart.forEach(item=>{
        html += `<tr><td>${item.id}</td><td>${item.qtd}</td></tr>`;
      });
      html+="</table>";
      container.innerHTML = html;
    }

    window.checkoutPix = function() {
      alert("ðŸš€ Gerar QRCode PIX aqui (futuro)");
    }

    window.buyWhatsApp = function(nome) {
      const numero="5551999999999"; // <-- SEU WHATSAPP
      const msg=`OlÃ¡, quero comprar: ${nome}`;
      window.open(`https://wa.me/${numero}?text=${encodeURIComponent(msg)}`);
    }

    window.checkoutWhatsApp = function() {
      const numero="5551999999999"; 
      const itens = cart.map(c=>`${c.qtd}x ${c.id}`).join(", ");
      const msg=`Meu pedido: ${itens}`;
      window.open(`https://wa.me/${numero}?text=${encodeURIComponent(msg)}`);
    }

    loadProducts();
    updateCartCount();
  </script>
</body>
</html>