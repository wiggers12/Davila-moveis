  </div>
  <div id="stock-list"></div>
</section>

<!-- Log√≠stica -->
<section id="logistica"><h2>üöö Log√≠stica</h2><div id="logistics-list"></div></section>

</div> <!-- fim app -->

<script>
/* Splash */
window.addEventListener("load",()=>{setTimeout(()=>{
  document.getElementById("splash").style.display="none";
  document.getElementById("app").style.display="block";
},2000);});

/* Toast */
function showToast(msg){
  let t=document.getElementById("toast");
  t.innerText=msg;t.style.display="block";
  setTimeout(()=>{t.style.display="none";},3000);
}

/* Dados */
let cart=[],orders=JSON.parse(localStorage.getItem("acaiOrders"))||[];
let PRODUCTS=JSON.parse(localStorage.getItem("acaiProducts"))||[];
const FRETE_FIXO=5.0;
const TOPPINGS=[{name:"Leite em p√≥",price:2},{name:"Morango",price:3},{name:"Granola",price:2},{name:"Leite condensado",price:2.5}];

/* Navega√ß√£o */
function showTab(id,btn){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
  if(btn) btn.classList.add("active");
  render();
}

/* Modal complementos */
let selectedProduct=null,selectedToppings=[];
function openModal(id){
  selectedProduct=PRODUCTS.find(p=>p.id===id);selectedToppings=[];
  document.getElementById("toppings").innerHTML=TOPPINGS.map((t,i)=>`<div class="topping"><label><input type="checkbox" value="${i}">${t.name} (+R$ ${t.price})</label></div>`).join("");
  document.getElementById("modal").style.display="flex";
}
function closeModal(){document.getElementById("modal").style.display="none";}
function confirmAdd(){
  let checkboxes=document.querySelectorAll("#toppings input:checked");
  let total=selectedProduct.price;let toppingsChosen=[];
  checkboxes.forEach(c=>{let t=TOPPINGS[c.value];toppingsChosen.push(t);total+=t.price;});
  cart.push({product:selectedProduct,toppings:toppingsChosen,total:total});
  selectedProduct.stock--;saveProducts();closeModal();updateCart();
  showToast("Produto adicionado ao carrinho!");
}

/* Render produtos */
let swiperInstance=null;
function renderProducts(){
 document.getElementById("products-container").innerHTML=PRODUCTS.map(p=>`
   <div class="swiper-slide">
     ${p.media && p.media.includes("video")?`<video src="${p.media}" controls></video>`:`<img src="${p.media}" alt="${p.name}">`}
     <div class="product-info">
       <h3>${p.name}</h3><p><strong>R$ ${p.price.toFixed(2)}</strong></p>
       <button class="order-button" onclick="openModal(${p.id})" ${p.stock<=0?"disabled":""}>${p.stock<=0?"Sem estoque":"Selecionar"}</button>
     </div>
   </div>`).join("");
 if(swiperInstance){swiperInstance.destroy();}
 swiperInstance=new Swiper(".swiper",{slidesPerView:1,loop:true});
}

/* Carrinho */
function updateCart(){
 let c=document.getElementById("cart-items");
 if(cart.length==0){c.innerHTML="<p>Seu carrinho est√° vazio</p>";}
 else{c.innerHTML=cart.map(it=>`<div class="cart-item">${it.product.name} ${it.toppings.length?"+ "+it.toppings.map(t=>t.name).join(", "):""} <span>R$ ${it.total.toFixed(2)}</span></div>`).join("");}
 document.getElementById("cart-total-price").innerText="R$ "+cart.reduce((s,i)=>s+i.total,0).toFixed(2);
 document.getElementById("finish-order-button").disabled=cart.length==0;
 document.getElementById("cart-badge").style.display=cart.length>0?"inline-block":"none";
 document.getElementById("cart-badge").innerText=cart.length;
}
document.getElementById("finish-order-button").addEventListener("click",finalizarPedido);

function finalizarPedido(){
 let subtotal=cart.reduce((s,i)=>s+i.total,0);
 let o={id:Date.now(),customerName:"",phone:"",deliveryType:"",address:"",notes:"",payment:"",items:cart,totalItems:subtotal,frete:0,total:subtotal,status:"Recebido",createdAt:new Date().toLocaleString()};
 orders.push(o);localStorage.setItem("acaiOrders",JSON.stringify(orders));cart=[];updateCart();showTab('logistica',document.getElementById("btn-logistica"));render();
 showToast("Pedido registrado e enviado para log√≠stica!");
}

/* Estoque */
function addProduct(){
 let file=document.getElementById("new-media").files[0];let reader=new FileReader();
 reader.onload=function(e){
   let p={id:Date.now(),name:document.getElementById("new-name").value,price:parseFloat(document.getElementById("new-price").value),cost:parseFloat(document.getElementById("new-cost").value),stock:parseInt(document.getElementById("new-stock").value),media:e.target.result};
   PRODUCTS.push(p);saveProducts();render();
 };
 if(file) reader.readAsDataURL(file);
}
function saveProducts(){localStorage.setItem("acaiProducts",JSON.stringify(PRODUCTS));}
function removeProduct(id){PRODUCTS=PRODUCTS.filter(p=>p.id!==id);saveProducts();render();}
function renderStock(){
 document.getElementById("stock-list").innerHTML=PRODUCTS.map(p=>`
   ${p.name} - R$ ${p.price.toFixed(2)} - Estoque:${p.stock}
   <button class="remove-btn" onclick="removeProduct(${p.id})">Remover</button>
 `).join("<br>");
}

/* Pedidos */
function renderOrders(){
 document.getElementById("orders-list").innerHTML=orders.map(o=>`
   <div class="order-card">
     <strong>Pedido #${o.id}</strong><br>
     Itens:<ul>${o.items.map(i=>`<li>${i.product.name} ${i.toppings.length?`+ ${i.toppings.map(t=>t.name).join(", ")}`:""} - R$ ${i.total.toFixed(2)}</li>`).join("")}</ul>
     Subtotal: R$ ${o.totalItems.toFixed(2)} | Total: R$ ${o.total.toFixed(2)}<br>
     <span class="status status-${o.status}">${o.status}</span>
   </div>`).join("");
 document.getElementById("orders-badge").style.display=orders.length>0?"inline-block":"none";
 document.getElementById("orders-badge").innerText=orders.filter(o=>o.status!=="Conclu√≠do"&&o.status!=="Cancelado").length;
}

/* Log√≠stica */
function renderLogistics(){
 let c=document.getElementById("logistics-list");
 if(orders.length===0){c.innerHTML="<p>Nenhum pedido na log√≠stica.</p>";return;}
 c.innerHTML=orders.map(o=>`
   <div class="order-card">
     <strong>Pedido #${o.id}</strong><br>
     Cliente: <input placeholder="Nome" value="${o.customerName}" onchange="o.customerName=this.value;saveOrders()"> 
     Tel: <input placeholder="Telefone" value="${o.phone}" onchange="o.phone=this.value;saveOrders()"><br>
     Entrega: <select onchange="setDelivery(${o.id},this.value)">
       <option ${o.deliveryType==="Retirada"?"selected":""}>Retirada</option>
       <option ${o.deliveryType==="Entrega"?"selected":""}>Entrega</option>
     </select><br>
     ${o.deliveryType==="Entrega"?`Endere√ßo:<input value="${o.address}" onchange="o.address=this.value;saveOrders()"><br>Observa√ß√µes:<input value="${o.notes}" onchange="o.notes=this.value;saveOrders()">`:``}
     Pagamento: <select onchange="o.payment=this.value;saveOrders()"><option>Pix</option><option>Dinheiro</option><option>Cart√£o</option></select><br>
     Subtotal: R$ ${o.totalItems.toFixed(2)} | Frete: R$ ${o.frete.toFixed(2)} | <strong>Total: R$ ${o.total.toFixed(2)}</strong><br>
     <small>Data: ${o.createdAt}</small><br>
     <span class="status status-${o.status}">${o.status}</span>
     <br><select onchange="updateStatus(${o.id},this.value)">
       <option ${o.status==="Recebido"?"selected":""}>Recebido</option>
       <option ${o.status==="Prepara√ß√£o"?"selected":""}>Prepara√ß√£o</option>
       <option ${o.status==="Saiu"?"selected":""}>Saiu</option>
       <option ${o.status==="Conclu√≠do"?"selected":""}>Conclu√≠do</option>
       <option ${o.status==="Cancelado"?"selected":""}>Cancelado</option>
     </select>
   </div>`).join("");
}
function setDelivery(id,val){
 let o=orders.find(x=>x.id===id);if(!o)return;
 o.deliveryType=val;
 if(val==="Entrega"){o.frete=FRETE_FIXO;o.total=o.totalItems+o.frete;}
 else{o.frete=0;o.total=o.totalItems;}
 saveOrders();renderLogistics();
}
function updateStatus(id,newStatus){
 let o=orders.find(x=>x.id===id);if(o){o.status=newStatus;saveOrders();renderLogistics();renderOrders();showToast("Status do pedido atualizado para "+newStatus);}
}
function saveOrders(){localStorage.setItem("acaiOrders",JSON.stringify(orders));}

/* Financeiro */
function renderFinance(){
 let concluidos=orders.filter(o=>o.status==="Conclu√≠do");
 let faturamento=concluidos.reduce((s,o)=>s+o.total,0);
 let freteTotal=concluidos.reduce((s,o)=>s+o.frete,0);
 let avg=concluidos.length?faturamento/concluidos.length:0;
 document.getElementById("kpi-revenue").innerText="R$ "+faturamento.toFixed(2);
 document.getElementById("kpi-orders").innerText=concluidos.length;
 document.getElementById("kpi-avg").innerText="R$ "+avg.toFixed(2);
 document.getElementById("kpi-frete").innerText="R$ "+freteTotal.toFixed(2);
 let salesByDay=concluidos.reduce((acc,o)=>{let d=new Date(o.createdAt).toLocaleDateString();acc[d]=(acc[d]||0)+o.total;return acc;},{});  
 let ctx=document.getElementById("salesChart").getContext("2d");
 if(window.salesChart)window.salesChart.destroy();
 window.salesChart=new Chart(ctx,{type:"bar",data:{labels:Object.keys(salesByDay),datasets:[{label:"Faturamento di√°rio",data:Object.values(salesByDay),backgroundColor:"rgba(157,77,237,0.7)"}]},options:{scales:{y:{beginAtZero:true}}}});
}

/* Render */
function render(){renderProducts();renderStock();renderOrders();renderLogistics();renderFinance();}
render();
</script>
</body>
</html>
