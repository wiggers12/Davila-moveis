<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A√ßa√≠ Imperial üëë</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{--primary:#6a0dad;--secondary:#f39c12;--success:#2ecc71;--info:#3498db;--danger:#e74c3c;
--bg:#f4f4f9;--light:#fff;--dark:#333;--shadow:0 4px 15px rgba(0,0,0,.1);}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Poppins',sans-serif;background:var(--bg);color:var(--dark);}
header{background:linear-gradient(135deg,var(--primary),#8e44ad);color:#fff;padding:1.5rem;text-align:center;border-bottom-left-radius:20px;border-bottom-right-radius:20px;box-shadow:0 4px 10px rgba(0,0,0,.3);}
header h1{margin:0;}
/* Splash */
#splash{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,var(--primary),#8e44ad);display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:2000;color:#fff;animation:fadeOut 1s 2.5s forwards;}
@keyframes fadeOut{to{opacity:0;visibility:hidden;}}
/* Produtos */
main{max-width:1200px;margin:auto;padding:2rem 1rem;}
.products-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.5rem;}
.product-card{background:#fff;border-radius:15px;box-shadow:var(--shadow);overflow:hidden;text-align:center;transition:.3s;}
.product-card:hover{transform:translateY(-5px);}
.product-card img{width:100%;height:180px;object-fit:cover;}
.product-info{padding:1rem;}
.price{color:var(--primary);font-weight:700;}
.order-button{background:var(--primary);color:#fff;border:none;border-radius:10px;padding:.7rem 1.2rem;width:100%;cursor:pointer;font-weight:600;}
.order-button:hover{background:#5a0a99;}
/* Carrinho */
.cart-container{background:#fff;padding:1rem;border-radius:10px;box-shadow:var(--shadow);}
.cart-item{display:flex;justify-content:space-between;align-items:center;padding:.5rem 0;border-bottom:1px solid #eee;}
.cart-total{font-size:1.3rem;text-align:right;margin-top:.5rem;font-weight:700;color:var(--primary);}
.btn-finish{background:var(--success);color:#fff;border:none;border-radius:10px;padding:.8rem;font-weight:700;width:100%;cursor:pointer;}
.btn-finish:disabled{background:#aaa;}
/* Builder Modal */
.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:1200;opacity:0;visibility:hidden;transition:.3s;}
.modal-overlay.active{opacity:1;visibility:visible;}
.modal-content{background:#fff;border-radius:15px;max-width:700px;width:95%;padding:1rem;}
.topping-item{border:2px solid #eee;border-radius:10px;padding:.5rem;text-align:center;cursor:pointer;}
.topping-item.selected{border-color:var(--primary);background:#f0e6f9;}
/* Confirma√ß√£o */
.confirm-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:1500;opacity:0;visibility:hidden;transition:.3s;}
.confirm-overlay.active{opacity:1;visibility:visible;}
.confirm-box{background:#fff;padding:2rem;border-radius:15px;max-width:400px;text-align:center;}
.confirm-box button{margin:.5rem;padding:.7rem 1rem;border:none;border-radius:8px;font-weight:600;cursor:pointer;}
.btn-ok{background:var(--success);color:#fff;}
.btn-cancel{background:#ccc;}
/* Loader */
.loader{border:5px solid #f3f3f3;border-top:5px solid var(--primary);border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin:auto;}
@keyframes spin{100%{transform:rotate(360deg);}}
/* Bot√£o WhatsApp */
.whatsapp-btn{position:fixed;bottom:20px;right:20px;background:#25d366;color:#fff;border-radius:50%;padding:15px;font-size:1.6rem;box-shadow:var(--shadow);cursor:pointer;}
/* Admin */
#admin-panel{display:none;}
.admin-nav{display:flex;justify-content:center;margin-bottom:1rem;flex-wrap:wrap;gap:.5rem;}
.admin-nav button{padding:.7rem 1.2rem;border:none;border-radius:8px;cursor:pointer;background:#eee;}
.admin-nav button.active{background:var(--primary);color:#fff;}
.kpi-card{background:#fff;padding:1rem;border-radius:10px;box-shadow:var(--shadow);text-align:center;margin:.5rem;}
.order-list-item{background:#fff;padding:1rem;margin:.5rem 0;border-radius:10px;box-shadow:var(--shadow);}
.order-status{font-weight:600;padding:.3rem .7rem;border-radius:10px;color:#fff;}
.status-Recebido{background:var(--info);}
.status-Em-Prepara√ß√£o{background:var(--secondary);}
.status-Conclu√≠do{background:var(--success);}
.status-Cancelado{background:var(--danger);}
</style>
</head>
<body>

<div id="splash"><h1>A√ßa√≠ Imperial üëë</h1><p>O sabor que te faz reinar!</p></div>

<header><h1>A√ßa√≠ Imperial üëë</h1><p>Monte seu a√ßa√≠ e pe√ßa j√°!</p></header>

<main id="customer-view">
<section>
<h2>Nosso Card√°pio</h2>
<div class="products-grid" id="products-container"></div>
</section>
<section style="margin-top:2rem;">
<h2>Seu Pedido</h2>
<div class="cart-container">
  <div id="cart-items"><p>Seu carrinho est√° vazio.</p></div>
  <div class="cart-total">Total: <span id="cart-total-price">R$ 0,00</span></div>
  <h3>Dados do Cliente</h3>
  <input id="client-name" placeholder="Seu nome">
  <input id="client-address" placeholder="Endere√ßo completo">
  <select id="payment-method"><option>Pix</option><option>Dinheiro</option><option>Cart√£o</option></select>
  <button class="btn-finish" id="finish-order-button" disabled>Finalizar Pedido</button>
</div>
</section>
</main>

<main id="admin-panel">
  <h2>Painel de Controle</h2>
  <nav class="admin-nav">
    <button onclick="showAdmin('deliveries')" class="active">üì¶ Pedidos</button>
    <button onclick="showAdmin('finance')">üí∞ Financeiro</button>
    <button onclick="showAdmin('stock')">üìä Estoque</button>
    <button onclick="showAdmin('logistics')">üöö Log√≠stica</button>
  </nav>
  <div id="deliveries" class="admin-view active"><h3>Pedidos</h3><div id="orders-list"></div></div>
  <div id="finance" class="admin-view"><h3>Financeiro</h3><div class="kpi-card"><h4>Faturamento</h4><p id="kpi-revenue">R$0,00</p></div><div class="kpi-card"><h4>Lucro L√≠quido</h4><p id="kpi-profit">R$0,00</p></div><canvas id="salesChart"></canvas><button onclick="exportCSV()">Exportar CSV</button></div>
  <div id="stock" class="admin-view"><h3>Estoque</h3><div id="stock-list"></div></div>
  <div id="logistics" class="admin-view"><h3>Log√≠stica</h3><div id="logistics-list"></div></div>
</main>

<!-- Builder Modal -->
<div class="modal-overlay" id="builder-modal">
 <div class="modal-content">
  <h3 id="modal-product-name"></h3>
  <div id="toppings-container"></div>
  <p>Total: <span id="builder-total">R$0,00</span></p>
  <button onclick="addToCart()">Adicionar ao Carrinho</button>
  <button onclick="closeModal()">Cancelar</button>
 </div>
</div>

<!-- Confirma√ß√£o -->
<div class="confirm-overlay" id="confirm-modal">
 <div class="confirm-box">
  <h3>Deseja enviar este pedido?</h3>
  <button class="btn-ok" onclick="confirmSend()">Sim</button>
  <button class="btn-cancel" onclick="closeConfirm()">Cancelar</button>
 </div>
</div>

<a href="https://wa.me/5551999999999" class="whatsapp-btn">üí¨</a>

<script>
const WHATSAPP_NUMBER="5551999999999";
const SENHA_ADMIN="1234";
let currentProduct=null,selectedToppings=[],cart=[],orders=JSON.parse(localStorage.getItem("acaiOrders"))||[];

// Produtos e adicionais com estoque/custo
const PRODUCTS=[{id:1,name:"Copo 300ml",price:12,cost:6,stock:20,image:"https://source.unsplash.com/400x300/?acai"},
{id:2,name:"Copo 500ml",price:18,cost:9,stock:15,image:"https://source.unsplash.com/400x301/?acai"},
{id:3,name:"Barca A√ßa√≠",price:35,cost:18,stock:10,image:"https://source.unsplash.com/400x302/?acai"}];
const TOPPINGS=[{name:"Leite em p√≥",price:2,cost:1,stock:30},{name:"Leite condensado",price:2.5,cost:1.2,stock:25},{name:"Granola",price:2,cost:0.8,stock:20},
{name:"Banana",price:1.5,cost:0.7,stock:20},{name:"Morango",price:3,cost:1.5,stock:15},{name:"Kiwi",price:3,cost:1.5,stock:15},{name:"Pa√ßoca",price:1,cost:0.4,stock:25},{name:"Creme de Avel√£",price:4,cost:2,stock:10}];

// Render produtos
function renderProducts(){document.getElementById("products-container").innerHTML=PRODUCTS.map(p=>`
  <div class="product-card"><img src="${p.image}"><div class="product-info"><h3>${p.name}</h3><p class="price">R$ ${p.price.toFixed(2)}</p>
  <button class="order-button" onclick='openBuilder(${JSON.stringify(p)})'>Montar meu A√ßa√≠</button></div></div>`).join("");}
// Builder
function openBuilder(product){currentProduct=product;selectedToppings=[];document.getElementById("modal-product-name").innerText="Monte seu "+product.name;
document.getElementById("toppings-container").innerHTML=TOPPINGS.map((t,i)=>`<div class="topping-item" id="t${i}" onclick='toggleTopping(${i})'>${t.name}<br>+R$${t.price}</div>`).join("");updateBuilderTotal();document.getElementById("builder-modal").classList.add("active");}
function toggleTopping(i){let t=TOPPINGS[i];let el=document.getElementById("t"+i);let idx=selectedToppings.findIndex(x=>x.name===t.name);
if(idx>-1){selectedToppings.splice(idx,1);el.classList.remove("selected");}else{selectedToppings.push(t);el.classList.add("selected");}updateBuilderTotal();}
function updateBuilderTotal(){let total=currentProduct.price+selectedToppings.reduce((s,t)=>s+t.price,0);document.getElementById("builder-total").innerText="R$ "+total.toFixed(2);}
function closeModal(){document.getElementById("builder-modal").classList.remove("active");}
function addToCart(){cart.push({product:currentProduct,toppings:[...selectedToppings],total:currentProduct.price+selectedToppings.reduce((s,t)=>s+t.price,0)});updateCart();closeModal();}
// Carrinho
function updateCart(){let c=document.getElementById("cart-items");
if(cart.length==0)c.innerHTML="<p>Seu carrinho est√° vazio.</p>";
else c.innerHTML=cart.map((item,i)=>`<div class="cart-item"><div><strong>${item.product.name}</strong><div>${item.toppings.map(t=>t.name).join(", ")||"Sem adicionais"}</div></div><div>R$ ${item.total.toFixed(2)}</div><button onclick="removeFromCart(${i})">‚ùå</button></div>`).join("");
document.getElementById("cart-total-price").innerText="R$ "+cart.reduce((s,i)=>s+i.total,0).toFixed(2);checkForm();}
function removeFromCart(i){cart.splice(i,1);updateCart();}
function checkForm(){let name=document.getElementById("client-name").value;let address=document.getElementById("client-address").value;document.getElementById("finish-order-button").disabled=!(name&&address&&cart.length>0);}
document.getElementById("client-name").addEventListener("input",checkForm);document.getElementById("client-address").addEventListener("input",checkForm);
document.getElementById("finish-order-button").addEventListener("click",()=>{document.getElementById("confirm-modal").classList.add("active");});
function closeConfirm(){document.getElementById("confirm-modal").classList.remove("active");}
function confirmSend(){let name=document.getElementById("client-name").value;let address=document.getElementById("client-address").value;let pay=document.getElementById("payment-method").value;
let order={id:Date.now(),customerName:name,customerAddress:address,payment:pay,items:cart,total:cart.reduce((s,i)=>s+i.total,0),status:"Recebido",createdAt:new Date().toISOString()};
orders.push(order);localStorage.setItem("acaiOrders",JSON.stringify(orders));
let msg=`üçß Pedido A√ßa√≠ Imperial üçß\nCliente:${name}\nEndere√ßo:${address}\nPagamento:${pay}\n\nItens:\n`;
cart.forEach(i=>{msg+=`- ${i.product.name} R$${i.total.toFixed(2)}\n${i.toppings.map(t=>t.name).join(", ")}\n`;});msg+=`\nTotal:R$${order.total.toFixed(2)}`;
window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`,"_blank");cart=[];updateCart();closeConfirm();}
// Admin
function showAdmin(view){document.querySelectorAll('.admin-view').forEach(v=>v.classList.remove('active'));document.getElementById(view).classList.add('active');
document.querySelectorAll('.admin-nav button').forEach(b=>b.classList.remove('active'));document.querySelector(`.admin-nav button[onclick="showAdmin('${view}')"]`).classList.add('active');
if(view==="deliveries")renderOrders();if(view==="finance")renderFinance();if(view==="stock")renderStock();if(view==="logistics")renderLogistics();}
function renderOrders(){let c=document.getElementById("orders-list");c.innerHTML=orders.map(o=>`<div class="order-list-item"><strong>Pedido #${o.id}</strong><br>${o.customerName}<br>${o.customerAddress}<br>Status:<span class="order-status status-${o.status.replace(" ","-")}">${o.status}</span><br>Total:R$${o.total.toFixed(2)}<br><select onchange="updateStatus(${o.id},this.value)"><option ${o.status==="Recebido"?"selected":""}>Recebido</option><option ${o.status==="Em Prepara√ß√£o"?"selected":""}>Em Prepara√ß√£o</option><option ${o.status==="Saiu para Entrega"?"selected":""}>Saiu para Entrega</option><option ${o.status==="Conclu√≠do"?"selected":""}>Conclu√≠do</option><option ${o.status==="Cancelado"?"selected":""}>Cancelado</option></select></div>`).join("");}
function updateStatus(id,s){let o=orders.find(x=>x.id===id);if(o){o.status=s;localStorage.setItem("acaiOrders",JSON.stringify(orders));renderOrders();renderFinance();}}
function renderFinance(){let done=orders.filter(o=>o.status==="Conclu√≠do");let rev=done.reduce((s,o)=>s+o.total,0);let cost=0;done.forEach(o=>{o.items.forEach(it=>{cost+=it.product.cost;it.toppings.forEach(t=>{let tp=TOPPINGS.find(x=>x.name===t.name);if(tp)cost+=tp.cost;});});});let profit
= rev - cost;
let avg = done.length > 0 ? rev / done.length : 0;
document.getElementById("kpi-revenue").innerText = "R$ " + rev.toFixed(2);
document.getElementById("kpi-profit").innerText = "R$ " + profit.toFixed(2);

// gr√°fico
let ctx = document.getElementById("salesChart").getContext("2d");
if (window.salesChart) window.salesChart.destroy();
window.salesChart = new Chart(ctx, {
  type: "bar",
  data: {
    labels: done.map(o => new Date(o.createdAt).toLocaleDateString()),
    datasets: [{
      label: "Faturamento",
      data: done.map(o => o.total),
      backgroundColor: "rgba(106,13,173,.7)"
    }]
  },
  options: {scales:{y:{beginAtZero:true}}}
});
}
function exportCSV() {
 let csv = "id,cliente,endereco,total,status,data\n";
 orders.forEach(o=>{
   csv += `${o.id},${o.customerName},${o.customerAddress},${o.total},${o.status},${o.createdAt}\n`;
 });
 let blob = new Blob([csv],{type:"text/csv"});
 let a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download="pedidos.csv";a.click();
}
// Estoque
function renderStock(){
 let c=document.getElementById("stock-list");
 c.innerHTML="<h4>Produtos</h4>"+
   PRODUCTS.map(p=>`<div>${p.name} - Estoque: ${p.stock} - Pre√ßo: R$${p.price} - Custo: R$${p.cost} ${p.stock<5?"‚ö† Estoque baixo":""}</div>`).join("")
  +"<h4>Adicionais</h4>"+
   TOPPINGS.map(t=>`<div>${t.name} - Estoque: ${t.stock} - Pre√ßo: R$${t.price} - Custo: R$${t.cost} ${t.stock<5?"‚ö† Estoque baixo":""}</div>`).join("");
}
// Log√≠stica
const entregadores=[{id:1,nome:"Carlos",fone:"5199999999"},{id:2,nome:"Ana",fone:"5198888888"}];
function renderLogistics(){
 let c=document.getElementById("logistics-list");
 let pend=orders.filter(o=>o.status==="Saiu para Entrega");
 if(pend.length===0){c.innerHTML="Nenhuma entrega em andamento";return;}
 c.innerHTML=pend.map(o=>`<div class="order-list-item"><strong>Pedido #${o.id}</strong><br>${o.customerName} - ${o.customerAddress}<br>
   <a target="_blank" href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(o.customerAddress)}">Abrir no Maps</a><br>
   <label>Atribuir entregador:</label>
   <select onchange="atribuirEntregador(${o.id},this.value)">
     <option>Selecione</option>
     ${entregadores.map(e=>`<option value="${e.nome}">${e.nome}</option>`).join("")}
   </select>
   </div>`).join("");
}
function atribuirEntregador(orderId, nome){
 let o=orders.find(x=>x.id===orderId);
 if(o){o.entregador=nome;localStorage.setItem("acaiOrders",JSON.stringify(orders));alert("Entregador "+nome+" atribu√≠do ao pedido #"+orderId);}
}
// Baixa de estoque ao concluir pedido
function baixarEstoque(order){
 order.items.forEach(it=>{
   let prod=PRODUCTS.find(p=>p.id===it.product.id);
   if(prod) prod.stock--;
   it.toppings.forEach(tp=>{
     let top=TOPPINGS.find(t=>t.name===tp.name);
     if(top) top.stock--;
   });
 });
}
// Inicializa√ß√£o
function checkView(){
 if(location.hash==="#admin"){
   let pass=prompt("Senha do Admin:");
   if(pass===SENHA_ADMIN){
     document.getElementById("customer-view").style.display="none";
     document.getElementById("admin-panel").style.display="block";
     renderOrders();
   } else {
     alert("Senha incorreta");location.hash="";
   }
 } else {
   document.getElementById("customer-view").style.display="block";
   document.getElementById("admin-panel").style.display="none";
   renderProducts();updateCart();
 }
}
window.addEventListener("hashchange",checkView);
document.addEventListener("DOMContentLoaded",checkView);
</script>
</body>
</html>